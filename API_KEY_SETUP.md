# 🔑 API密钥配置指南

## 📋 功能介绍

GUI版本提供了便捷的API密钥配置功能，无需手动设置环境变量。

## 🎯 配置步骤

### 1. 启动GUI界面
```bash
python run_gui.py
```

### 2. 配置API密钥
1. 在"AI模型选择"区域选择要配置的模型（zhipu/doubao）
2. 点击"🔑 配置API密钥"按钮
3. 在弹出的对话框中输入API密钥
4. 可选：点击"🔍 测试连接"验证密钥有效性
5. 点击"✅ 确定"保存配置

### 3. 配置效果
配置成功后系统会：
- ✅ **临时设置**：立即在当前进程中生效
- ✅ **永久保存**：保存到系统环境变量，下次启动自动加载

## 🔧 技术实现

### 支持的操作系统
- ✅ **Windows**：写入用户注册表环境变量
- ✅ **macOS**：写入 ~/.zshrc 和 ~/.bash_profile
- ✅ **Linux**：写入 ~/.bashrc 和 ~/.profile

### 环境变量映射
| 模型 | 环境变量名 |
|------|------------|
| zhipu | ZHIPUAI_API_KEY |
| doubao | DOUBAO_API_KEY |

### Windows系统实现
```python
# 写入用户注册表
HKEY_CURRENT_USER\Environment
# 通知系统环境变量更改
SendMessageW(HWND_BROADCAST, WM_SETTINGCHANGE, 0, "Environment")
```

### macOS/Linux系统实现
```bash
# 写入shell配置文件
echo 'export ZHIPUAI_API_KEY="your_key"' >> ~/.zshrc
echo 'export ZHIPUAI_API_KEY="your_key"' >> ~/.bash_profile
```

## 🎨 界面特性

### API密钥状态显示
- ✅ **已配置**：显示"✅ 已配置 (abcd1234...xyz9)"
- ❌ **未配置**：显示"❌ 未配置"

### 配置对话框功能
- 🔑 **密钥输入**：支持显示/隐藏密钥
- 🔍 **连接测试**：验证API密钥有效性
- 💾 **安全保存**：临时+永久双重保存

### 自动更新
- 🔄 **模型切换**：切换模型时自动更新状态
- 📊 **实时显示**：配置后立即更新状态显示

## 🛡️ 安全特性

### 密钥保护
- 🔒 **输入保护**：默认隐藏密钥输入
- 🎭 **显示保护**：状态显示时遮蔽大部分字符
- 💾 **存储安全**：系统级环境变量存储

### 权限处理
- 👤 **用户级别**：仅设置当前用户的环境变量
- 🔐 **权限友好**：无需管理员权限
- 🔄 **降级处理**：永久保存失败时仍可临时使用

## 🚀 使用建议

### 首次配置
1. 先配置常用的AI模型（如zhipu）
2. 使用"测试连接"验证配置正确性
3. 配置成功后即可开始分析

### 多模型配置
1. 可以为不同模型配置不同的API密钥
2. 切换模型时会自动显示对应的配置状态
3. 支持随时重新配置或更新密钥

### 故障排除
1. **永久保存失败**：检查系统权限，可手动设置环境变量
2. **连接测试失败**：检查网络连接和密钥有效性
3. **配置不生效**：重启应用程序或检查环境变量设置

## 💡 命令行替代方案

如果不使用GUI，也可以手动设置环境变量：

### Windows
```cmd
setx ZHIPUAI_API_KEY "your_api_key"
```

### macOS/Linux
```bash
echo 'export ZHIPUAI_API_KEY="your_api_key"' >> ~/.zshrc
source ~/.zshrc
```

## 🎉 优势总结

相比手动配置环境变量，GUI配置具有以下优势：

- ✅ **零学习成本**：可视化操作，无需记忆命令
- ✅ **即时生效**：临时+永久双重设置
- ✅ **状态可见**：实时显示配置状态
- ✅ **跨平台**：自动适配不同操作系统
- ✅ **安全友好**：密钥保护和权限控制
- ✅ **错误处理**：友好的错误提示和降级方案

现在用户可以通过GUI界面轻松配置API密钥，无需手动设置环境变量！🎊
